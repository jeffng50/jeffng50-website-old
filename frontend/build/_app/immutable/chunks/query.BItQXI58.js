const __vite__fileDeps=["./client.D9Eo8C9s.js","./session.Cb_pzrJv.js","./scheduler.VSw_3VqK.js","./control.CYgJF_JY.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var xe=Object.defineProperty;var Ve=r=>{throw TypeError(r)};var Ye=(r,e,t)=>e in r?xe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var g=(r,e,t)=>Ye(r,typeof e!="symbol"?e+"":e,t),ke=(r,e,t)=>e.has(r)||Ve("Cannot "+t);var b=(r,e,t)=>(ke(r,e,"read from private field"),t?t.call(r):e.get(r)),T=(r,e,t)=>e.has(r)?Ve("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),I=(r,e,t,s)=>(ke(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),R=(r,e,t)=>(ke(r,e,"access private method"),t);var je=(r,e,t,s)=>({set _(i){I(r,e,i,t)},get _(){return b(r,e,s)}});import{k as Fe}from"./scheduler.VSw_3VqK.js";import{g as Pe,c as Xe,i as Ze}from"./session.Cb_pzrJv.js";import{_ as Ue}from"./preload-helper.D6kgxu3v.js";const et={watchSchema:{url:"http://127.0.0.1:1337/graphql"},plugins:{"houdini-svelte":{}}},tt=[];var st=tt;function Ae(r){return{defaultKeys:["id"],...r,types:{Node:{keys:["id"],resolve:{queryField:"node",arguments:e=>({id:e.id})}},...r.types}}}function Be(r,e){var s,i;const t=Ae(r);return((i=(s=t.types)==null?void 0:s[e])==null?void 0:i.keys)||t.defaultKeys}function it(r,e,t){const s=Be(r,e);let i="";for(const n of s)i+=t[n]+"__";return i.slice(0,-2)}let ve=null;function Pt(r){var e;return((e=r.router)==null?void 0:e.apiEndpoint)??"/_api"}function we(){if(ve)return ve;let r=Ae(et);for(const e of st)r=e(r);return ve=r,r}function Ke(r){const e=[...r.matchAll(/\$HOUDINI\$(\w*\$)?/g)];if(e.length===0)return[r];let t=r.replaceAll(/\$HOUDINI\$(\w*\$)?/g,"%c"),s=[];for(const i of e){const n=i[1]?`color:${i[1].slice(0,-1)}`:"";s.push(n)}return[t,...s]}function nt(r){console.error(...Ke(r))}function rt(r){console.log(...Ke(r))}const J={CacheOrNetwork:"CacheOrNetwork",CacheOnly:"CacheOnly",NetworkOnly:"NetworkOnly",CacheAndNetwork:"CacheAndNetwork",NoCache:"NoCache"},re={Query:"HoudiniQuery",Subscription:"HoudiniSubscription",Mutation:"HoudiniMutation",Fragment:"HoudiniFragment"},at=re.Query,Se={Cache:"cache",Network:"network",Ssr:"ssr"},Ee=" $fragments",lt=Symbol("houdini_loading");let ne=null;async function We(){return ne||(ne=(await Ue(async()=>{const{default:r}=await import("./client.D9Eo8C9s.js");return{default:r}},__vite__mapDeps([0,1,2,3]),import.meta.url)).default,ne)}function $e(){if(!ne)throw new Error("client hasn't been initialized");return ne}function me(r,e,t=new WeakMap){if(Object.is(r,e))return!0;if(r instanceof Date&&e instanceof Date)return r.getTime()===e.getTime();if(r instanceof RegExp&&e instanceof RegExp)return r.toString()===e.toString();if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;if(t.get(r)===e)return!0;t.set(r,e);const s=Reflect.ownKeys(r),i=Reflect.ownKeys(e);if(s.length!==i.length)return!1;for(let n=0;n<s.length;n++)if(!Reflect.has(e,s[n])||!me(r[s[n]],e[s[n]],t))return!1;return!0}function K(r,e,t){if(t)return r.loadingTypes&&r.loadingTypes.length>0?Qe(...r.loadingTypes.map(i=>{var n;return(n=r.abstractFields)==null?void 0:n.fields[i]})):r.fields??{};let s=r.fields||{};if(r.abstractFields&&e){const i=r.abstractFields.typeMap[e];i?s=r.abstractFields.fields[i]:r.abstractFields.fields[e]&&(s=r.abstractFields.fields[e])}return s}function Qe(...r){const e={};for(let t of r)if(t){for(let s in t)if(s in t){const i=t[s];typeof i=="object"&&i!==null&&!Array.isArray(i)?e[s]=Qe(e[s]||{},i):e[s]=i}}return e}async function Ne({selection:r,data:e}){const t=we();if(e===null||typeof e>"u")return e;if(Array.isArray(e))return await Promise.all(e.map(i=>Ne({selection:r,data:i})));const s=K(r,e.__typename,!1);return Object.fromEntries(await Promise.all(Object.entries(e).map(async([i,n])=>{var o;if(i===Ee)return[i,n];const{type:a,selection:l}=s[i];if(!a)return[i,n];if(l)return[i,await Ne({selection:l,data:n})];if((o=t.scalars)!=null&&o[a]){const c=t.scalars[a].marshal;if(!c)throw new Error(`scalar type ${a} is missing a \`marshal\` function. see https://github.com/AlecAivazis/houdini#%EF%B8%8Fcustom-scalars`);return Array.isArray(n)?[i,n.map(c)]:[i,c(n)]}return[i,n]})))}function Oe({artifact:r,input:e,config:t,rootType:s="@root"}){if(e===null||typeof e>"u"||!r.input)return e;const i=s==="@root"?r.input.fields:r.input.types[s];return Array.isArray(e)?e.map(n=>Oe({artifact:r,input:n,rootType:s,config:t})):Object.fromEntries(Object.entries(e).map(([n,a])=>{var c,f;const l=i==null?void 0:i[n];if(!l)return[n,a];const o=(f=(c=t.scalars)==null?void 0:c[l])==null?void 0:f.marshal;return o?Array.isArray(a)?[n,a.map(o)]:[n,o(a)]:ot(t,l)||!r.input.types[l]?[n,a]:[n,Oe({artifact:r,input:a,rootType:l,config:t})]}))}function ot(r,e){return["String","Boolean","Float","ID","Int"].concat(Object.keys(r.scalars||{})).includes(e)}function $t(r,e,t){if(!(typeof t>"u"))return t}const ie=[],De=()=>{};var N,W,de;class ct{constructor(e,t=De){g(this,"state");T(this,N);T(this,W);T(this,de);this.state=e,I(this,N,new Set),I(this,W,null),I(this,de,t)}set(e){if(ft(this.state,e)&&(this.state=e,b(this,W))){const t=!ie.length;for(const s of b(this,N))s[1](),ie.push(s,this.state);if(t){for(let s=0;s<ie.length;s+=2)ie[s][0](ie[s+1]);ie.length=0}}}update(e){this.set(e(this.state))}subscribe(e,t=De){const s=[e,t];return b(this,N).add(s),b(this,N).size===1&&I(this,W,b(this,de).call(this,this.set)||De),e(this.state),()=>{var i;b(this,N).delete(s),b(this,N).size===0&&((i=b(this,W))==null||i.call(this),I(this,W,null))}}}N=new WeakMap,W=new WeakMap,de=new WeakMap;function ft(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}const He=({field:r,args:e})=>{const t=Object.keys(e??{});return t.sort(),e&&t.length>0?`${r}(${t.map(s=>`${s}: ${Te(e[s])}`).join(", ")})`:r},Te=r=>Array.isArray(r)?`[${r.map(e=>`${Te(e)}`).join(", ")}]`:typeof r!="object"||r instanceof Date||r===null?JSON.stringify(r).replace(/"([^"]+)":/g,"$1: "):`{${Object.keys(r).map(e=>`${e}: ${Te(r[e])}`).join(", ")}}`;function q(r){return r?r.reduce((e,t)=>t?Array.isArray(t)?e.concat(q(t)):e.concat(t):e,[]):[]}class ut{constructor(e){g(this,"cache");g(this,"lifetimes",new Map);this.cache=e}get cacheBufferSize(){return this.cache._internal_unstable.config.cacheBufferSize??10}reset(){this.lifetimes.clear()}resetLifetime(e,t){this.lifetimes.get(e)||this.lifetimes.set(e,new Map),this.lifetimes.get(e).set(t,0)}tick(){const e=Date.now().valueOf(),t=this.cache._internal_unstable.config.defaultLifetime;for(const[s,i]of this.lifetimes.entries())for(const[n,a]of i.entries())if(!(this.cache._internal_unstable.subscriptions.get(s,n).length>0)&&(i.set(n,a+1),i.get(n)>this.cacheBufferSize&&(this.cache._internal_unstable.storage.deleteField(s,n),this.cache._internal_unstable.lists.deleteField(s,n),i.delete(n),[...i.keys()].length===0&&this.lifetimes.delete(s),this.cache._internal_unstable.staleManager.delete(s,n)),t&&t>0)){const l=this.cache.getFieldTime(s,n);l&&e-l>t&&this.cache._internal_unstable.staleManager.markFieldStale(s,n)}}}class ht{constructor(e,t){g(this,"rootID");g(this,"cache");g(this,"lists",new Map);g(this,"listsByField",new Map);this.rootID=t,this.cache=e}get(e,t,s){var o;const i=this.lists.get(e);if(!i||i.size===0)return null;if(s)return new _e(Array.from(i,([c,f])=>[...f.lists]).flat());const n=[...i.values()][0],{recordType:a}=n.lists[0],l=t?this.cache._internal_unstable.id(a||"",t):this.rootID;return(i==null?void 0:i.size)===1?t?l===Array.from(i.keys())[0]?n:null:n:t?(o=this.lists.get(e))==null?void 0:o.get(l):(console.error(`Found multiple instances of "${e}". Please provide one of @parentID or @allLists directives to help identify which list you want modify. For more information, visit this guide: https://www.houdinigraphql.com/api/graphql#parentidvalue-string `),null)}remove(e,t){var s;(s=this.lists.get(e))==null||s.delete(t||this.rootID)}add(e){var n,a,l;this.lists.has(e.name)||this.lists.set(e.name,new Map);const t=e.name,s=e.recordID||this.rootID;if((a=(n=this.lists.get(t))==null?void 0:n.get(s))!=null&&a.includes(e.key))return;this.lists.has(t)||this.lists.set(t,new Map),this.lists.get(t).has(s)||this.lists.get(t).set(s,new _e([])),this.listsByField.has(s)||this.listsByField.set(s,new Map),this.listsByField.get(s).has(e.key)||(l=this.listsByField.get(s))==null||l.set(e.key,[]);const i=new dt({...e,manager:this});this.lists.get(e.name).get(s).lists.push(i),this.listsByField.get(s).get(e.key).push(i)}removeIDFromAllLists(e,t){for(const s of this.lists.values())for(const i of s.values())i.removeID(e,void 0,t)}deleteField(e,t){var s,i,n,a,l,o;if((s=this.listsByField.get(e))!=null&&s.has(t)){for(const c of this.listsByField.get(e).get(t))(n=(i=this.lists.get(c.name))==null?void 0:i.get(c.recordID))==null||n.deleteListWithKey(t),((l=(a=this.lists.get(c.name))==null?void 0:a.get(c.recordID))==null?void 0:l.lists.length)===0&&((o=this.lists.get(c.name))==null||o.delete(c.recordID));this.listsByField.get(e).delete(t)}}reset(){this.lists.clear(),this.listsByField.clear()}}class dt{constructor({name:e,recordID:t,recordType:s,key:i,listType:n,selection:a,when:l,filters:o,connection:c,manager:f,abstract:u}){g(this,"recordID");g(this,"recordType");g(this,"key");g(this,"type");g(this,"cache");g(this,"selection");g(this,"_when");g(this,"filters");g(this,"name");g(this,"connection");g(this,"manager");g(this,"abstract");this.recordID=t||B,this.recordType=s,this.key=i,this.type=n,this.cache=f.cache,this.selection=a,this._when=l,this.filters=o,this.name=e,this.connection=c,this.manager=f,this.abstract=u}when(e){return this.manager.lists.get(this.name).get(this.recordID).when(e)}append({selection:e,data:t,variables:s={},layer:i}){return this.addToList(e,t,s,"last",i)}prepend({selection:e,data:t,variables:s={},layer:i}){return this.addToList(e,t,s,"first",i)}addToList(e,t,s={},i,n){const a=this.listType(t),l=this.cache._internal_unstable.id(a,t);if(!this.validateWhen()||!l)return;let o=e,c=t;this.connection?(o={fields:{newEntry:{keyRaw:this.key,type:"Connection",selection:{fields:{edges:{keyRaw:"edges",type:"ConnectionEdge",updates:["append","prepend"],selection:{fields:{__typename:{keyRaw:"__typename",type:"String"},node:{type:a,keyRaw:"node",selection:{...e,fields:{...e.fields,__typename:{keyRaw:"__typename",type:"String"}}}}}}}}}}}},c={newEntry:{edges:[{__typename:a+"Edge",node:{...t,__typename:a}}]}}):(o={fields:{newEntries:{keyRaw:this.key,type:a,updates:["append","prepend"],selection:{...e,fields:{...e.fields,__typename:{keyRaw:"__typename",type:"String"}}}}}},c={newEntries:[{...t,__typename:a}]}),this.cache.write({selection:o,data:c,variables:s,parent:this.recordID,applyUpdates:[i==="first"?"prepend":"append"],layer:n==null?void 0:n.id})}removeID(e,t={},s){var c;if(!this.validateWhen())return;let i=this.recordID,n=e,a=this.key;if(this.connection){const{value:f}=this.cache._internal_unstable.storage.get(this.recordID,this.key);if(!f)return;const u=f,{value:h}=this.cache._internal_unstable.storage.get(u,"edges");for(const y of q(h)||[]){if(!y)continue;const m=y,{value:d}=this.cache._internal_unstable.storage.get(m,"node");d&&d===e&&(n=m)}i=u,a="edges"}let l=this.cache._internal_unstable.storage.get(i,a).value;if(!l||!l.includes(n))return;const o=this.cache._internal_unstable.subscriptions.get(this.recordID,this.key);this.cache._internal_unstable.subscriptions.remove(n,this.connection?this.selection.fields.edges.selection:this.selection,o.map(f=>f[0]),t),this.cache._internal_unstable.storage.remove(i,a,n,s);for(const[f]of o)f.set(this.cache._internal_unstable.getSelection({parent:f.parentID||this.manager.rootID,selection:f.selection,variables:((c=f.variables)==null?void 0:c.call(f))||{},ignoreMasking:!1}).data);return!0}remove(e,t={},s){const i=this.cache._internal_unstable.id(this.listType(e),e);if(i)return this.removeID(i,t,s)}listType(e){return e.__typename||this.type}validateWhen(e){let t=e||this._when,s=!0;if(t){const i=this.filters;t.must&&i&&(s=Object.entries(t.must).reduce((n,[a,l])=>!!(n&&i[a]==l),s)),t.must_not&&(s=!i||Object.entries(t.must_not).reduce((n,[a,l])=>!!(n&&i[a]!=l),s))}return s}toggleElement({selection:e,data:t,variables:s={},layer:i,where:n}){this.remove(t,s,i)||this.addToList(e,t,s,n,i)}*[Symbol.iterator](){let e=[],t=this.cache._internal_unstable.storage.get(this.recordID,this.key).value;this.connection?e=this.cache._internal_unstable.storage.get(t,"edges").value:e=q(t);for(let s of e)yield s}}class _e{constructor(e){g(this,"lists",[]);this.lists=e}get selection(){return this.lists[0].selection}append(...e){this.lists.forEach(t=>t.append(...e))}prepend(...e){this.lists.forEach(t=>t.prepend(...e))}addToList(...e){this.lists.forEach(t=>t.addToList(...e))}removeID(...e){this.lists.forEach(t=>t.removeID(...e))}remove(...e){this.lists.forEach(t=>t.remove(...e))}toggleElement(...e){this.lists.forEach(t=>t.toggleElement(...e))}when(e){return new _e(this.lists.filter(t=>t.validateWhen(e)))}includes(e){return!!this.lists.find(t=>t.key===e)}deleteListWithKey(e){return this.lists=this.lists.filter(t=>t.key!==e)}*[Symbol.iterator](){for(let e of this.lists)for(const t of e)yield t}}var pe;class pt{constructor(e){g(this,"cache");g(this,"fieldsTime",new Map);T(this,pe,e=>{this.fieldsTime.get(e)||this.fieldsTime.set(e,new Map)});this.cache=e}getFieldTime(e,t){var s;return(s=this.fieldsTime.get(e))==null?void 0:s.get(t)}setFieldTimeToNow(e,t){var s;b(this,pe).call(this,e),(s=this.fieldsTime.get(e))==null||s.set(t,new Date().valueOf())}markFieldStale(e,t){var s;b(this,pe).call(this,e),(s=this.fieldsTime.get(e))==null||s.set(t,null)}markAllStale(){for(const[e,t]of this.fieldsTime.entries())for(const[s]of t.entries())this.markFieldStale(e,s)}markRecordStale(e){const t=this.fieldsTime.get(e);if(t)for(const[s]of t.entries())this.markFieldStale(e,s)}markTypeStale(e){for(const[t,s]of this.fieldsTime.entries())if(t.startsWith(`${e}:`))for(const[i]of s.entries())this.markFieldStale(t,i)}markTypeFieldStale(e,t,s){const i=He({field:t,args:s});for(const[n,a]of this.fieldsTime.entries())if(n.startsWith(`${e}:`))for(const l of a.keys())l===i&&this.markFieldStale(n,t)}delete(e,t){var s,i;this.fieldsTime.has(e)&&((s=this.fieldsTime.get(e))==null||s.delete(t),((i=this.fieldsTime.get(e))==null?void 0:i.size)===0&&this.fieldsTime.delete(e))}reset(){this.fieldsTime.clear()}}pe=new WeakMap;class gt{constructor(){g(this,"data");g(this,"idCount",1);g(this,"rank",0);this.data=[]}get layerCount(){return this.data.length}get nextRank(){return this.rank++}createLayer(e=!1){const t=new yt(this.idCount++);return t.optimistic=e,this.data.push(t),t}insert(e,t,s,i){return this.topLayer.insert(e,t,s,i)}remove(e,t,s,i=this.topLayer){return i.remove(e,t,s)}delete(e,t=this.topLayer){return t.delete(e)}deleteField(e,t){return this.topLayer.deleteField(e,t)}getLayer(e){for(const t of this.data)if(t.id===e)return t;throw new Error("Could not find layer with id: "+e)}replaceID(e){for(const t of this.data)t.replaceID(e)}get(e,t,s){const i={[G.insert]:{[ze.start]:[],[ze.end]:[]},[G.remove]:new Set},n=[];for(let a=this.data.length-1;a>=0;a--){const l=this.data[a];let[o,c]=l.get(e,t);const f=l.getOperations(e,t)||[];if(l.deletedIDs.forEach(u=>{var h,y;(y=(h=l.operations[u])==null?void 0:h.undoDeletesInList)!=null&&y.includes(t)||i.remove.add(u)}),typeof o>"u"&&s){const u=this.topLayer;u.id,u.writeField(e,t,s),o=s}if(typeof o>"u"&&f.length===0){l.deletedIDs.size>0&&n.push(l.id);continue}if(typeof o<"u"&&!Array.isArray(o))return{value:o,kind:c,displayLayers:[l.id]};if(n.push(l.id),f.length>0){for(const u of f)if(_t(u)&&i.remove.add(u.id),mt(u)&&i.insert[u.location].unshift(u.id),bt(u))return{value:void 0,kind:"unknown",displayLayers:[]}}if(!(typeof o>"u"))return!i.remove.size&&!i.insert.start.length&&!i.insert.end.length?{value:o,displayLayers:n,kind:"link"}:{value:[...i.insert.start,...o,...i.insert.end].filter(u=>!i.remove.has(u)),displayLayers:n,kind:c}}return{value:void 0,kind:"unknown",displayLayers:[]}}writeLink(e,t,s){return this.topLayer.writeLink(e,t,s)}writeField(e,t,s){return this.topLayer.writeField(e,t,s)}resolveLayer(e){let t=null;for(const[n,a]of this.data.entries())if(a.id===e){t=n-1,this.data[n].optimistic=!1;break}if(t===null)throw new Error("could not find layer with id: "+e);t===-1&&(t=0),this.data[t].optimistic&&t++;const s=this.data[t];let i=t;for(;i<this.data.length;){const n=this.data[i++];if(n.optimistic){i--;break}s.writeLayer(n)}this.data.splice(t+1,i-t-1)}get topLayer(){var e;return this.data.length===0&&this.createLayer(),(e=this.data[this.data.length-1])!=null&&e.optimistic&&this.createLayer(),this.data[this.data.length-1]}serialize(){return JSON.stringify({rank:this.rank,fields:Object.fromEntries(Object.entries(this.topLayer.fields).map(([e,t])=>[e,Object.fromEntries(Object.entries(t).filter(([s,i])=>typeof i!="function"))])),links:this.topLayer.links})}hydrate(e,t){if(!e)return;const{rank:s,fields:i,links:n}=e;this.rank=s,t??(t=this.createLayer(!0)),t.fields=i,t.links=n}reset(){this.data=[]}}class yt{constructor(e){g(this,"id");g(this,"optimistic",!1);g(this,"fields",{});g(this,"links",{});g(this,"operations",{});g(this,"deletedIDs",new Set);this.id=e}get(e,t){var s,i;return typeof((s=this.links[e])==null?void 0:s[t])<"u"?[this.links[e][t],"link"]:[(i=this.fields[e])==null?void 0:i[t],"scalar"]}getOperations(e,t){var s,i,n;if((s=this.operations[e])!=null&&s.deleted)return[{kind:G.delete,target:e}];if((n=(i=this.operations[e])==null?void 0:i.fields)!=null&&n[t])return this.operations[e].fields[t]}writeField(e,t,s){return this.fields[e]={...this.fields[e],[t]:s},this.id}writeLink(e,t,s){var n,a,l;const i=Array.isArray(s)?s:[s];for(const o of q(i)){if(!o)continue;const c=(n=this.operations[e])==null?void 0:n.fields[t];(a=this.operations[o])!=null&&a.deleted||this.deletedIDs.has(o)?this.operations[o]={...this.operations[o],undoDeletesInList:[...((l=this.operations[e])==null?void 0:l.undoDeletesInList)||[],t]}:o&&(c==null?void 0:c.length)>0&&(this.operations[e].fields[t]=c.filter(f=>f.kind!=="remove"||f.id!==o))}return this.links[e]={...this.links[e],[t]:s},this.id}isDisplayLayer(e){return e.length===0||e.includes(this.id)||Math.max(...e)<this.id}clear(){this.links={},this.fields={},this.operations={},this.deletedIDs=new Set}replaceID({from:e,to:t}){this.fields[t]=this.fields[e],this.links[t]=this.links[e],this.operations[t]=this.operations[e]||{fields:{}},this.deletedIDs.has(e)&&this.deletedIDs.add(t)}removeUndefinedFields(){for(const[e,t]of Object.entries(this.fields)){for(const[s,i]of Object.entries(t))if(typeof i>"u"){try{delete this.fields[e][s]}catch{}try{delete this.links[e][s]}catch{}}Object.keys(t||{}).length===0&&delete this.fields[e],Object.keys(this.links[e]||{}).length===0&&delete this.links[e]}}delete(e){this.operations={...this.operations,[e]:{...this.operations[e],deleted:!0,undoDeletesInList:[]}},this.deletedIDs.add(e)}deleteField(e,t){this.fields[e]={...this.fields[e],[t]:void 0}}insert(e,t,s,i){this.addFieldOperation(e,t,{kind:G.insert,id:i,location:s})}remove(e,t,s){this.addFieldOperation(e,t,{kind:G.remove,id:s})}writeLayer(e){if(e.id!==this.id){for(const[t,s]of Object.entries(e.operations)){const i={};for(const n of[this.operations[t],e.operations[t]].filter(Boolean))for(const[a,l]of Object.entries(n.fields||{}))i[a]=[...i[a]||[],...l];Object.keys(i).length>0&&(this.operations[t]={...this.operations[t],fields:i}),s!=null&&s.deleted&&(delete this.fields[t],delete this.links[t])}for(const[t,s]of Object.entries(e.fields))if(s)for(const[i,n]of Object.entries(s))this.writeField(t,i,n);for(const[t,s]of Object.entries(e.links))if(s)for(const[i,n]of Object.entries(s))this.writeLink(t,i,n);e.deletedIDs.forEach(t=>this.deletedIDs.add(t))}}addFieldOperation(e,t,s){var i;this.operations={...this.operations,[e]:{...this.operations[e],fields:{[t]:[...((i=this.operations[e])==null?void 0:i.fields[t])||[],s]}}}}}function bt(r){return!!r&&r.kind===G.delete}function mt(r){return!!r&&r.kind===G.insert}function _t(r){return!!r&&r.kind===G.remove}const ze={start:"start",end:"end"},G={delete:"delete",insert:"insert",remove:"remove"};function he(r,e=null){let t="",s="",i=!1;for(const n of r){if(s){if(wt.includes(n)){s+=n;continue}const a=e==null?void 0:e[s.slice(1)];t+=typeof a<"u"?JSON.stringify(a):"undefined",s=""}if(n==="$"&&!i){s="$";continue}n==='"'&&(i=!i),t+=n}return t}const wt="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789";class kt{constructor(e){g(this,"cache");g(this,"subscribers",new Map);g(this,"keyVersions",{});this.cache=e}activeFields(e){return Object.keys(this.subscribers.get(e)||{})}add({parent:e,spec:t,selection:s,variables:i,parentType:n}){const a=this.cache._internal_unstable.storage.get(e,"__typename").value;let l=K(s,a,!1);for(const o of Object.values(l||{})){const{keyRaw:c,selection:f,type:u,list:h,filters:y,visible:m}=o;if(!m)continue;const d=he(c,i);let w;if(f){const v=this.cache._internal_unstable.storage.get(e,"__typename").value;w=K(f,v,!1)}if(this.addFieldSubscription({id:e,key:d,selection:[t,w],type:u}),h&&this.registerList({list:h,filters:y,id:e,key:d,variables:i,selection:f,parentType:n||t.rootType}),f){const{value:v}=this.cache._internal_unstable.storage.get(e,d);let _=Array.isArray(v)?q(v)||[]:[v];for(const k of _)k&&this.add({parent:k,spec:t,selection:f,variables:i,parentType:u})}}}addFieldSubscription({id:e,key:t,selection:s,type:i}){const n=s[0];this.subscribers.has(e)||this.subscribers.set(e,new Map);const a=this.subscribers.get(e);a.has(t)||a.set(t,{selections:[],referenceCounts:new Map});const l=a.get(t);this.keyVersions[t]||(this.keyVersions[t]=new Set),this.keyVersions[t].add(t),l.selections.some(([{set:o}])=>o===n.set)||l.selections.push([n,s[1]]),l.referenceCounts.set(n.set,(l.referenceCounts.get(n.set)||0)+1),this.cache._internal_unstable.lifetimes.resetLifetime(e,t)}registerList({list:e,id:t,key:s,parentType:i,selection:n,filters:a,variables:l}){var o;this.cache._internal_unstable.lists.add({name:e.name,connection:e.connection,recordID:t,recordType:((o=this.cache._internal_unstable.storage.get(t,"__typename"))==null?void 0:o.value)||i,listType:e.type,key:s,selection:n,filters:Object.entries(a||{}).reduce((c,[f,{kind:u,value:h}])=>({...c,[f]:u!=="Variable"?h:l[h]}),{})})}addMany({parent:e,variables:t,subscribers:s,parentType:i}){for(const[n,a]of s)for(const l of Object.values(a??{})){const{type:o,keyRaw:c,selection:f,list:u,filters:h}=l,y=he(c,t),m=f?K(f,i,!1):void 0;this.addFieldSubscription({id:e,key:y,selection:[n,m],type:o}),u&&this.registerList({list:u,filters:h,id:e,key:y,variables:t,selection:f,parentType:i||n.rootType});const d=l.selection;if(d){const{value:w}=this.cache._internal_unstable.storage.get(e,y),v=Array.isArray(w)?q(w):[w];for(const _ of v){if(!_)continue;const k=this.cache._internal_unstable.storage.get(_,"__typename").value;let L=K(d,k,!1);this.addMany({parent:_,variables:t,subscribers:s.map(([P])=>[P,L]),parentType:o})}}}}get(e,t){var s,i;return((i=(s=this.subscribers.get(e))==null?void 0:s.get(t))==null?void 0:i.selections)||[]}remove(e,t,s,i,n=[]){n.push(e);const a=[],l=this.cache._internal_unstable.storage.get(e,"__typename").value;let o=K(t,l,!1);for(const c of Object.values(o||{})){const f=he(c.keyRaw,i);if(this.removeSubscribers(e,f,s),!c.selection)continue;const{value:u}=this.cache._internal_unstable.storage.get(e,f),h=Array.isArray(u)?q(u):[u];for(const y of h)y!==null&&a.push([y,c.selection||{}])}for(const[c,f]of a)this.remove(c,f,s,n)}reset(){const e=[...this.subscribers.entries()].filter(([s])=>!s.startsWith(B));for(const[s,i]of e)this.subscribers.delete(s);return e.flatMap(([s,i])=>[...i.values()].flatMap(n=>n.selections.map(([a])=>a)))}removeSubscribers(e,t,s){var l;let i=[];const n=this.subscribers.get(e);if(!n)return;const a=n.get(t);for(const o of s){const c=(l=n.get(t))==null?void 0:l.referenceCounts;if(!(c!=null&&c.has(o.set)))continue;const f=(c.get(o.set)||0)-1;c.set(o.set,f),f<=0&&(i.push(o.set),c.delete(o.set)),c.size===0&&n.delete(t)}a&&(a.selections=this.get(e,t).filter(([{set:o}])=>!i.includes(o))),n.size===0&&this.subscribers.delete(e)}removeAllSubscribers(e,t,s=[]){s.push(e);const i=this.subscribers.get(e);for(const[n,a]of(i==null?void 0:i.entries())??[]){const l=t||a.selections.map(([u])=>u);this.removeSubscribers(e,n,l);const{value:o,kind:c}=this.cache._internal_unstable.storage.get(e,n);if(c==="scalar")continue;const f=Array.isArray(o)?q(o):[o];for(const u of f)s.includes(u)||this.removeAllSubscribers(u,l,s)}}get size(){let e=0;for(const[,t]of this.subscribers)for(const[,{referenceCounts:s}]of t)e+=[...s.values()].reduce((i,n)=>i+n,0);return e}}var vt={},ae,ye;class Je{constructor({disabled:e,componentCache:t,createComponent:s,...i}={}){T(this,ae);g(this,"_internal_unstable");this._internal_unstable=new St({cache:this,storage:new gt,subscriptions:new kt(this),lists:new ht(this,B),lifetimes:new ut(this),staleManager:new pt(this),disabled:e??typeof globalThis.window>"u",componentCache:t,createComponent:s}),Object.keys(i).length>0&&this.setConfig(Ae(i))}write({layer:e,notifySubscribers:t=[],...s}){const i=e?this._internal_unstable.storage.getLayer(e):this._internal_unstable.storage.topLayer,n=this._internal_unstable.writeSelection({...s,layer:i}).map(a=>a[0]);return R(this,ae,ye).call(this,n.concat(t)),n}read(...e){const{data:t,partial:s,stale:i,hasData:n}=this._internal_unstable.getSelection(...e);return n?{data:t,partial:s,stale:i}:{data:null,partial:!1,stale:!1}}subscribe(e,t={}){if(!this._internal_unstable.disabled)return this._internal_unstable.subscriptions.add({parent:e.parentID||B,spec:e,selection:e.selection,variables:t})}unsubscribe(e,t={}){return this._internal_unstable.subscriptions.remove(e.parentID||B,e.selection,[e],t)}list(e,t,s){const i=this._internal_unstable.lists.get(e,t,s);if(!i)throw new Error(`Cannot find list with name: ${e}${t?" under parent "+t:""}. Is it possible that the query is not mounted?`);return i}delete(e,t){this._internal_unstable.subscriptions.removeAllSubscribers(e),this._internal_unstable.lists.removeIDFromAllLists(e,t),this._internal_unstable.storage.delete(e,t)}setConfig(e){this._internal_unstable.setConfig(e)}markTypeStale(e){e?e.field?this._internal_unstable.staleManager.markTypeFieldStale(e.type,e.field,e.when):this._internal_unstable.staleManager.markTypeStale(e.type):this._internal_unstable.staleManager.markAllStale()}markRecordStale(e,t){if(t.field){const s=He({field:t.field,args:t.when??{}});this._internal_unstable.staleManager.markFieldStale(e,s)}else this._internal_unstable.staleManager.markRecordStale(e)}getFieldTime(e,t){return this._internal_unstable.staleManager.getFieldTime(e,t)}config(){return this._internal_unstable.config}serialize(){return this._internal_unstable.storage.serialize()}hydrate(...e){return this._internal_unstable.storage.hydrate(...e)}clearLayer(e){const t=this._internal_unstable.storage.getLayer(e);if(!t)throw new Error("Cannot find layer with id: "+e);const s=[],i=[];for(const a of[t.fields,t.links])for(const[l,o]of Object.entries(a))i.push(...Object.entries(o).map(([c,f])=>({id:l,field:c,value:f})));const n=[];for(const a of i){const{displayLayers:l}=this._internal_unstable.storage.get(a.id,a.field);l.includes(e)&&n.push(a)}for(const[a,l]of Object.entries(t.operations)){l.deleted&&n.push(...this._internal_unstable.subscriptions.activeFields(a).map(c=>({id:a,field:c})));const o=Object.keys(l.fields??{});o.length>0&&n.push(...o.map(c=>({id:a,field:c})))}t.clear();for(const a of n){const{field:l,id:o}=a;(!("value"in a)||this._internal_unstable.storage.get(o,l).value!==a.value)&&s.push(...this._internal_unstable.subscriptions.get(o,l).map(f=>f[0]))}R(this,ae,ye).call(this,s)}reset(){const e=this._internal_unstable.subscriptions.reset();this._internal_unstable.staleManager.reset(),this._internal_unstable.lifetimes.reset(),this._internal_unstable.lists.reset(),this._internal_unstable.storage.reset(),R(this,ae,ye).call(this,e)}}ae=new WeakSet,ye=function(e){var s;if(e.length===0)return;const t=[];for(const i of e)t.includes(i.set)||(t.push(i.set),i.set(this._internal_unstable.getSelection({parent:i.parentID||B,selection:i.selection,variables:((s=i.variables)==null?void 0:s.call(i))||{},ignoreMasking:!1}).data))};class St{constructor({storage:e,subscriptions:t,lists:s,cache:i,lifetimes:n,staleManager:a,disabled:l,config:o,componentCache:c,createComponent:f}){g(this,"disabled",!1);g(this,"_config");g(this,"storage");g(this,"subscriptions");g(this,"lists");g(this,"cache");g(this,"lifetimes");g(this,"staleManager");g(this,"componentCache");g(this,"createComponent");this.storage=e,this.subscriptions=t,this.lists=s,this.cache=i,this.lifetimes=n,this.staleManager=a,this._config=o,this.componentCache=c??{},this.createComponent=f??(()=>({})),this.disabled=l;try{vt.HOUDINI_TEST==="true"&&(this.disabled=!1)}catch{}}get config(){return this._config??we()}setConfig(e){this._config=e}writeSelection({data:e,selection:t,variables:s={},parent:i=B,applyUpdates:n,layer:a,toNotify:l=[],forceNotify:o,forceStale:c}){if(this.disabled)return[];let f=K(t,e.__typename,!1);for(const[u,h]of Object.entries(e)){if(!t||!f[u])continue;let{type:y,keyRaw:m,selection:d,operations:w,abstract:v,updates:_}=f[u];const k=he(m,s);h&&typeof h=="object"&&"__typename"in h&&h.__typename&&(y=h.__typename);const L=this.subscriptions.get(i,k),P=L.map(p=>p[0]),{value:O,displayLayers:fe}=this.storage.get(i,k),se=a.isDisplayLayer(fe);if(se&&(this.lifetimes.resetLifetime(i,k),c?this.staleManager.markFieldStale(i,k):this.staleManager.setFieldTimeToNow(i,k)),d){if(h===null){if(O===null)continue;const p=q([O]);for(const D of p)this.subscriptions.remove(D,d,P,s);a.writeLink(i,k,null),l.push(...L)}else if(h instanceof Object&&!Array.isArray(h)){if(v&&!h.__typename)throw new Error("Encountered interface type without __typename in the payload");let p=null;h!==null&&(p=this.isEmbedded(y,h)?`${i}.${k}`:this.id(y,h));let D=p!==O;a.writeLink(i,k,p),p&&se&&(D||o)&&(O&&typeof O=="string"&&this.subscriptions.remove(O,d,P,s),this.subscriptions.addMany({parent:p,subscribers:L,variables:s,parentType:y}),l.push(...L)),p&&this.writeSelection({selection:d,parent:p,data:h,variables:s,toNotify:l,applyUpdates:n,layer:a,forceNotify:o})}else if(Array.isArray(h)&&(typeof O>"u"||O===null||Array.isArray(O))){let p=[...O||[]];const D=_?p.map(S=>{if(!S)return"";const{value:M}=this.storage.get(S,"cursor");if(M)return"";const{value:V}=this.storage.get(S,"node");return V||""}):[];let A=[];const{newIDs:F,nestedIDs:x}=this.extractNestedListIDs({value:h,abstract:!!v,specs:l,applyUpdates:n,recordID:i,key:k,linkedType:y,variables:s,fields:d,layer:a,forceNotify:o});if(n&&_){if(k==="edges"){const S=[];for(const M of F){if(!M)continue;const{value:V}=this.storage.get(M,"node");typeof V=="string"&&(!V||!this.storage.get(V,"__typename")||S.push(V))}p=p.filter(M=>{if(!M)return!0;const{value:V}=this.storage.get(M,"node"),E=V;return!(S.includes(E)&&D.includes(E))})}for(const S of n)S!=="replace"&&!_.includes(S)||(S==="prepend"?A=F.concat(p):S==="append"?A=p.concat(F):S==="replace"&&(A=F))}else A=x;const ue=!me(A,p)||O===null;(ue||o)&&l.push(...L);for(const S of p)A.includes(S)||!S||this.subscriptions.remove(S,d,P,s);(ue||p.length===0&&F.length===0)&&a.writeLink(i,k,A);for(const S of F.filter(M=>!p.includes(M)))S!=null&&this.subscriptions.addMany({parent:S,subscribers:L,variables:s,parentType:y})}}else{let p=h;if(_&&n&&Array.isArray(h))for(const A of n)_.includes(A)&&(A==="append"?p=(O||[]).concat(h):A==="prepend"&&(p=h.concat(O||[])));(_&&(n!=null&&n.includes("prepend"))&&["endCursor","hasNextPage"].includes(k)||_&&(n!=null&&n.includes("append"))&&["startCursor","hasPreviousPage"].includes(k))&&(p=O);const D=!me(p,O);se&&(D||o)&&l.push(...L),a.writeField(i,k,p)}for(const p of w||[]){let D;if(p.parentID)if(p.parentID.kind!=="Variable")D=p.parentID.value;else{const F=s[p.parentID.value];if(typeof F!="string")throw new Error("parentID value must be a string");D=F}if(p.list&&!this.lists.get(p.list,D,p.target==="all"))continue;const A=Array.isArray(h)?h:[h];for(const F of A)if(p.action==="insert"&&F instanceof Object&&d&&p.list)this.cache.list(p.list,D,p.target==="all").when(p.when).addToList(d,F,s,p.position||"last",a);else if(p.action==="toggle"&&F instanceof Object&&d&&p.list)this.cache.list(p.list,D,p.target==="all").when(p.when).toggleElement({selection:d,data:F,variables:s,where:p.position||"last",layer:a});else if(p.action==="remove"&&F instanceof Object&&d&&p.list)this.cache.list(p.list,D,p.target==="all").when(p.when).remove(F,s,a);else if(p.action==="delete"&&p.type&&F){const x=this.id(p.type,F);if(!x)continue;this.cache.delete(x,a)}}}return l}getSelection({selection:e,parent:t=B,variables:s,stepsFromConnection:i=null,ignoreMasking:n,fullCheck:a=!1,loading:l}){var d,w,v;if(t===null)return{data:null,partial:!1,stale:!1,hasData:!0};const o={};e.fragments&&(o[Ee]={loading:!!l,values:Object.fromEntries(Object.entries(e.fragments).filter(([,_])=>!l||_.loading).map(([_,k])=>[_,{parent:t,variables:be(k.arguments,s??{})}]))});let c=!!e.fragments,f=!1,u=!1,h=!1;const y=this.storage.get(t,"__typename").value;let m=K(e,y,!!l);for(const[_,{type:k,keyRaw:L,selection:P,nullable:O,list:fe,visible:se,directives:p,loading:D,abstractHasRequired:A,component:F}]of Object.entries(m)){if(!se&&!n&&!a)continue;const x=p==null?void 0:p.find(C=>C.name==="include");if(x&&!be(x.arguments,s??{}).if)continue;const ue=p==null?void 0:p.find(C=>C.name==="skip");if(ue&&be(ue.arguments,s??{}).if)continue;const S=se||n?o:{},M=he(L,s);if(l&&!D)continue;const V=F?Dt({cache:this.cache,component:F,variables:s,parent:t}):void 0;let{value:E}=this.storage.get(t,M,V);this.staleManager.getFieldTime(t,M)===null&&(h=!0),l&&(E=void 0);let Y=i;Y!==null&&(Y>=2?Y=null:Y+=1),fe!=null&&fe.connection&&(Y=0);const Re=M==="cursor"&&i===1;if(typeof E>"u"&&!Re&&(f=!0),l&&(D==null?void 0:D.kind)==="value")S[_]=lt,c=!0;else if(!l&&typeof E>"u"||E===null)S[_]=null,typeof E<"u"&&(c=!0);else if(P)if(Array.isArray(E)){const C=this.hydrateNestedList({fields:P,variables:s,linkedList:E,stepsFromConnection:Y,ignoreMasking:!!n,fullCheck:a,loading:l,nullable:!!O});S[_]=C.data,C.partial&&(f=!0),C.cascadeNull&&(u=!0),C.stale&&(h=!0),(C.hasData||E.length===0)&&(c=!0)}else{const C=this.getSelection({parent:E,selection:P,variables:s,stepsFromConnection:Y,ignoreMasking:n,fullCheck:a,loading:l});S[_]=C.data,C.partial&&(f=!0),C.stale&&(h=!0),C.hasData&&(c=!0)}else{const C=(v=(w=(d=this.config)==null?void 0:d.scalars)==null?void 0:w[k])==null?void 0:v.unmarshal;C?S[_]=C(E):S[_]=E,c=!0}l&&(D!=null&&D.list)&&(S[_]=Ge(Array.from({length:D.list.count}).fill(S[_]),D.list.depth-1)),S[_]===null&&!O&&!Re&&(A?o[_]={__typename:"@required field missing; don't match this"}:u=!0)}return{data:u?null:o,partial:!l&&c&&f,stale:c&&h,hasData:c}}id(e,t){const s=typeof t=="object"?this.computeID(e,t):t;return s?e?e+":"+s:s:null}idFields(e){return Be(this.config,e)}computeID(e,t){return it(this.config,e,t)}isEmbedded(e,t){const s=this.idFields(e);return s.length===0||s.filter(i=>typeof t[i]>"u").length>0}hydrateNestedList({fields:e,variables:t,linkedList:s,stepsFromConnection:i,ignoreMasking:n,fullCheck:a,loading:l,nullable:o}){const c=[];let f=!1,u=!1,h=!1,y=!1;for(const m of s){if(Array.isArray(m)){const k=this.hydrateNestedList({fields:e,nullable:o,variables:t,linkedList:m,stepsFromConnection:i,ignoreMasking:n,fullCheck:a,loading:l});c.push(k.data),k.partial&&(f=!0),k.cascadeNull&&(y=!0);continue}if(m===null){c.push(m);continue}const{data:d,partial:w,stale:v,hasData:_}=this.getSelection({parent:m,selection:e,variables:t,stepsFromConnection:i,ignoreMasking:n,fullCheck:a,loading:l});d===null&&!o&&(y=!0),c.push(d),w&&(f=!0),v&&(u=!0),_&&(h=!0)}return{data:c,partial:f,stale:u,hasData:h,cascadeNull:y}}extractNestedListIDs({value:e,abstract:t,recordID:s,key:i,linkedType:n,fields:a,variables:l,applyUpdates:o,specs:c,layer:f,forceNotify:u}){const h=[],y=[];for(const[m,d]of e.entries()){if(Array.isArray(d)){const L=this.extractNestedListIDs({value:d,abstract:t,recordID:s,key:i,linkedType:n,fields:a,variables:l,applyUpdates:o,specs:c,layer:f,forceNotify:u});y.push(...L.newIDs),h[m]=L.nestedIDs;continue}if(d===null||typeof d>"u"){y.push(null),h[m]=null;continue}const w=d;let v=`${s}.${i}[${this.storage.nextRank}]`,_=n;const k=w.__typename;if(k)_=k;else if(t)throw new Error("Encountered interface type without __typename in the payload");if(!this.isEmbedded(n,d)){const L=this.id(_,d);if(L)v=L;else continue}this.writeSelection({root:B,selection:a,parent:v,data:w,variables:l,toNotify:c,applyUpdates:o,layer:f,forceNotify:u}),y.push(v),h[m]=v}return{newIDs:y,nestedIDs:h}}collectGarbage(){this.lifetimes.tick(),this.storage.layerCount===1&&this.storage.topLayer.removeUndefinedFields()}}function be(r,e){return Object.fromEntries(Object.entries(r).map(([t,s])=>[t,Le(s,e)]))}function Ge(r,e=0){return e===0?r:Ge([r],e-1)}function Le(r,e){if(r.kind==="StringValue"||r.kind==="BooleanValue"||r.kind==="EnumValue")return r.value;if(r.kind==="FloatValue")return parseFloat(r.value);if(r.kind==="IntValue")return parseInt(r.value,10);if(r.kind==="NullValue")return null;if(r.kind==="Variable")return e[r.name.value];if(r.kind==="ListValue")return r.values.map(t=>Le(t,e));if(r.kind==="ObjectValue")return r.fields.reduce((t,s)=>({...t,[s.name.value]:Le(s.value,e)}),{})}const B="_ROOT_";function Dt({cache:r,component:e,loading:t,variables:s,parent:i}){return n=>{const a=r._internal_unstable.componentCache[e.key],l=be(e.variables??{},s??{});return r._internal_unstable.createComponent(a,{...n,[e.prop]:{[Ee]:{loading:t,values:{[e.fragment]:{variables:l,parent:i}}}}})}}var It=new Je;const Ie=typeof globalThis.window>"u",Ft=({enabled:r,setFetching:e,cache:t=It,serverSideFallback:s=!0})=>()=>({beforeNetwork(i,{initialValue:n,next:a,resolve:l,marshalVariables:o}){var h,y;const{policy:c,artifact:f}=i;let u=!1;if(r&&(f.kind===re.Query||f.kind===re.Fragment)&&!((h=i.cacheParams)!=null&&h.disableRead)&&c!==J.NetworkOnly&&c!==J.NoCache){const d=t.read({selection:f.selection,variables:o(i),fullCheck:!0}),w=!d.partial||f.kind===re.Query&&f.partial;if(c===J.CacheOnly)return l(i,{fetching:!1,variables:i.variables??null,data:w?d.data:n.data,errors:null,source:Se.Cache,partial:w?d.partial:!1,stale:d.stale});if(u=!!(d.data!==null&&w),u&&l(i,{fetching:!1,variables:i.variables??null,data:d.data,errors:null,source:Se.Cache,partial:d.partial,stale:d.stale}),u&&!d.partial&&!d.stale&&i.policy!=="CacheAndNetwork")return}if(r&&setTimeout(()=>{t._internal_unstable.collectGarbage()},0),!((y=i.stuff)!=null&&y.silenceLoading)){let m=null;!u&&"enableLoadingState"in f&&f.enableLoadingState&&(m=t.read({selection:f.selection,variables:o(i),loading:!0}).data),e(!u,m)}return a(i)},afterNetwork(i,{resolve:n,value:a,marshalVariables:l}){var o,c,f;if(i.policy!==J.NoCache&&a.source!==Se.Cache&&r&&a.data&&!((o=i.cacheParams)!=null&&o.disableWrite)){i.cacheParams&&"serverSideFallback"in i.cacheParams&&(s=((c=i.cacheParams)==null?void 0:c.serverSideFallback)??s);const u=Ie&&s?new Je({disabled:!1}):t;let h;!Ie&&((f=i.cacheParams)!=null&&f.layer)&&(h=i.cacheParams.layer.id),u.write({...i.cacheParams,layer:h,selection:i.artifact.selection,data:a.data,variables:l(i)}),a={...a,data:u.read({selection:i.artifact.selection,variables:l(i),ignoreMasking:Ie}).data}}n(i,a)}}),qe={forward:["start","beforeNetwork","network"],backwards:["end","afterNetwork"]};var X,ge,z,Z,le,j,$;class Ot extends ct{constructor({artifact:t,plugins:s,pipeline:i,client:n,cache:a,enableCache:l=!0,initialValue:o,initialVariables:c,fetching:f}){f??(f=t.kind===re.Query);super({data:o??null,errors:null,partial:!1,stale:!1,source:null,fetching:f,variables:c??null},()=>()=>{I(this,Z,null),this.cleanup()});T(this,j);g(this,"artifact");T(this,X);T(this,ge);T(this,z);T(this,Z);T(this,le,null);g(this,"pendingPromise",null);g(this,"serverSideFallback");this.artifact=t,I(this,X,n),I(this,Z,null),I(this,ge,we()),I(this,z,i??[Ft({cache:a,enabled:l,setFetching:(h,y)=>{this.update(m=>{const d={...m,fetching:h};return h&&y&&(d.data=y),d})}})(),...s??[]])}async send({metadata:t,session:s,fetch:i,variables:n,policy:a,stuff:l,cacheParams:o,setup:c=!1,silenceEcho:f=!1}={}){let u=new Ce({config:b(this,ge),name:this.artifact.name,text:this.artifact.raw,hash:this.artifact.hash,policy:a??this.artifact.policy,variables:null,metadata:t,session:s,fetch:i??this.getFetch(()=>s),stuff:{inputs:{changed:!1,init:!1,marshaled:{}},...l},artifact:this.artifact,lastVariables:b(this,Z),cacheParams:o});const h=u.draft();h.variables=n??null,u=u.apply(h,!1);const y=new Promise((m,d)=>{const w={setup:c,currentStep:0,index:0,silenceEcho:f,promise:{resolved:!1,resolve:m,reject:d,then:(...v)=>y.then(...v)},context:u};this.pendingPromise===null&&(this.pendingPromise=w.promise),R(this,j,$).call(this,"forward",w)});return await y}async cleanup(){var t;for(const s of b(this,z))(t=s.cleanup)==null||t.call(s,b(this,le))}getFetch(t){return async(s,i)=>{var l;let n="",a=[];if(typeof s=="string"&&(n=s.startsWith("http")?new URL(s).pathname:s),s instanceof URL?n=s.pathname:s instanceof Request&&(n=new URL(s.url).pathname),s instanceof Request){const o=await s.json();Array.isArray(o)||(a=[o])}else{const o=JSON.parse(i==null?void 0:i.body);Array.isArray(o)||(a=[o])}if(!n||a.length===0)return await globalThis.fetch(s,i);if((l=b(this,X))!=null&&l.proxies[n]){const o=await Promise.all(a.map(c=>{var f;return(f=b(this,X))==null?void 0:f.proxies[n]({...c,session:t()})}));return new Response(JSON.stringify(o.length===1?o[0]:o))}return await globalThis.fetch(s,i)}}}X=new WeakMap,ge=new WeakMap,z=new WeakMap,Z=new WeakMap,le=new WeakMap,j=new WeakSet,$=function(t,s,i){var o;const n=t==="error"?"catch":qe[t][s.currentStep];let a=c=>c<=b(this,z).length,l=c=>c+1;["backwards","error"].includes(t)&&(a=c=>c>=0,l=c=>c-1);for(let c=s.index;a(c);c=l(c)){let f=(o=b(this,z)[c])==null?void 0:o[n];if(!f)continue;const u=s.context.draft();let h=d=>d.variables!==u.variables;const y={initialValue:this.state,client:b(this,X),variablesChanged:Lt,marshalVariables:Tt,updateState:this.update.bind(this),next:d=>{const w=["forward","error"].includes(t)?c+1:c,v=["backwards","error"].includes(t)?0:s.currentStep;R(this,j,$).call(this,"forward",{...s,index:w,currentStep:v,context:s.context.apply(d,h(d))})},resolve:(d,w)=>{const v=t==="backwards"?c-1:c;R(this,j,$).call(this,"backwards",{...s,index:v,context:s.context.apply(d,h(d))},w)}};let m;t==="forward"?m=y:t==="backwards"?m={...y,value:i,resolve:(d,w)=>y.resolve(d,w??i)}:t==="error"&&(m={...y,error:i});try{const d=f(u,m);d==null||d.catch(w=>{R(this,j,$).call(this,"error",{...s,index:c-1},w)})}catch(d){R(this,j,$).call(this,"error",{...s,index:c-1},d)}return}if(t==="forward"){if(s.setup)return R(this,j,$).call(this,"backwards",{...s,currentStep:0,index:b(this,z).length},this.state);if(s.currentStep<=qe.forward.length-2)return R(this,j,$).call(this,"forward",{...s,currentStep:s.currentStep+1,index:0});throw new Error("Called next() on last possible plugin. Your chain is missing a plugin that calls resolve().")}if(t==="error"){s.promise.resolved||(s.promise.reject(i),s.promise.resolved=!0);return}if(s.currentStep>0)return R(this,j,$).call(this,"backwards",{...s,currentStep:s.currentStep-1,index:b(this,z).length-1},i);(!s.silenceEcho||i.data!==this.state.data)&&this.set(i),s.promise.resolved||(s.promise.resolve(i),s.promise.resolved=!0),I(this,le,s.context.draft()),I(this,Z,b(this,le).stuff.inputs.marshaled)};var U,oe;const Me=class Me{constructor({lastVariables:e,...t}){T(this,U);T(this,oe);I(this,U,t),I(this,oe,e)}get variables(){return b(this,U).variables}draft(){const e={...b(this,U)},t=this.applyVariables.bind(this);return{...e,get stuff(){return e.stuff},set stuff(s){e.stuff=s},get variables(){return e.variables??null},set variables(s){Object.assign(e,t(e,{variables:s}))}}}applyVariables(e,t){var c,f;const s=e.artifact,i={...e,...t},n=t.variables;let a={};for(const[u,h]of Object.entries(n??{}))h!==((c=e.variables)==null?void 0:c[u])&&(a[u]=h);i.stuff={...i.stuff,inputs:{...i.stuff.inputs}};const l=!i.stuff.inputs||!i.stuff.inputs.init;if(Object.keys(a).length>0||l){const u={...(f=i.stuff.inputs)==null?void 0:f.marshaled,...Oe({artifact:s,input:a,config:e.config})};i.stuff.inputs={init:!0,marshaled:u,changed:!0},i.variables=n}return i.stuff={...i.stuff,inputs:{...i.stuff.inputs,changed:!me(i.stuff.inputs.marshaled,b(this,oe))}},i}apply(e,t){return t&&(e=this.applyVariables(b(this,U),e)),new Me({...e,lastVariables:b(this,oe)})}};U=new WeakMap,oe=new WeakMap;let Ce=Me;function Tt(r){var e;return((e=r.stuff.inputs)==null?void 0:e.marshaled)??{}}function Lt(r){var e;return(e=r.stuff.inputs)==null?void 0:e.changed}var ee,ce,Q,te,H;class Ct{constructor(e){T(this,ee);T(this,ce);T(this,Q,null);T(this,te,null);T(this,H,0);typeof e.initialize>"u"&&(e.initialize=!0),I(this,ce,new Ot({artifact:e.artifact,client:null,fetching:e.fetching,initialValue:e.initialValue})),I(this,ee,e)}get artifact(){return b(this,ee).artifact}get name(){return this.artifact.name}get observer(){return b(this,te)?b(this,te):(I(this,te,$e().observe(b(this,ee))),b(this,te))}subscribe(...e){const t=b(this,ce).subscribe(...e);return(b(this,H)===0||!b(this,Q))&&this.setup(),I(this,H,(b(this,H)??0)+1),()=>{var s;je(this,H)._--,b(this,H)<=0&&((s=b(this,Q))==null||s.call(this),I(this,Q,null),t())}}setup(e=!0){let t=Promise.resolve();try{$e()}catch{t=We()}t.then(()=>{if(!b(this,Q)&&(I(this,Q,this.observer.subscribe(s=>{b(this,ce).set(s)})),e&&b(this,ee).initialize))return this.observer.send({setup:!0,variables:Fe(this.observer).variables})})}}ee=new WeakMap,ce=new WeakMap,Q=new WeakMap,te=new WeakMap,H=new WeakMap;class Nt extends Ct{constructor({artifact:t,storeName:s,variables:i}){var a;const n=((a=t.pluginData["houdini-svelte"])==null?void 0:a.isManualLoad)!==!0;super({artifact:t,fetching:n,initialize:!t.pluginData["houdini-svelte"].isManualLoad});g(this,"variables");g(this,"kind",at);g(this,"loadPending",!1);g(this,"storeName");this.storeName=s,this.variables=i}async fetch(t){var v;const s=await We();this.setup(!1);const{policy:i,params:n,context:a}=await At(this.artifact,this.storeName,t),l=!!("event"in n&&n.event),o=!l;if(this.loadPending&&o)return nt(`⚠️ Encountered fetch from your component while ${this.storeName}.load was running.
This will result in duplicate queries. If you are trying to ensure there is always a good value, please a CachePolicy instead.`),Fe(this.observer);o&&(n.blocking=!0);const f=we().plugins["houdini-svelte"],u=this.artifact.pluginData["houdini-svelte"];let h=!1;(s.throwOnError_operations.includes("all")||s.throwOnError_operations.includes("query"))&&f.defaultRouteBlocking===!1&&rt('[Houdini] ⚠️ throwOnError with operation "all" or "query", is not compatible with defaultRouteBlocking set to "false"'),f.defaultRouteBlocking===!0&&(h=!0),(s.throwOnError_operations.includes("all")||s.throwOnError_operations.includes("query"))&&(h=!0),(u==null?void 0:u.set_blocking)===!0?h=!0:(u==null?void 0:u.set_blocking)===!1&&(h=!1),(n==null?void 0:n.blocking)===!0?h=!0:(n==null?void 0:n.blocking)===!1&&(h=!1),l&&(this.loadPending=!0),this.artifact.enableLoadingState&&(h=!1);const y=Xe&&Ze&&!h,m={...(v=this.artifact.input)==null?void 0:v.defaults,...n.variables};i!==J.NetworkOnly&&i!==J.NoCache&&y&&await this.observer.send({fetch:a.fetch,variables:m,metadata:n.metadata,session:a.session,policy:J.CacheOnly,silenceEcho:!0});const w=this.observer.send({fetch:a.fetch,variables:m,metadata:n.metadata,session:a.session,policy:i,stuff:{}});return w.then(_=>{var k;this.loadPending=!1,(k=n.then)==null||k.call(n,_.data)}).catch(()=>{}),y||await w,Fe(this.observer)}}async function At(r,e,t){let s=t==null?void 0:t.policy;!s&&r.kind===re.Query&&(s=r.policy??J.CacheOrNetwork);let i=null;t&&("fetch"in t&&t.fetch?i=t.fetch:"event"in t&&t.event&&"fetch"in t.event&&(i=t.event.fetch)),i||(i=globalThis.fetch.bind(globalThis));let n;return t&&"event"in t&&t.event?n=await Pe(t.event):n=await Pe(),{context:{fetch:i,metadata:(t==null?void 0:t.metadata)??{},session:n},policy:s,params:t??{}}}export{re as A,Se as D,Nt as Q,Ot as a,It as c,me as d,q as f,we as g,We as i,Pt as l,Ne as m,$t as p};
